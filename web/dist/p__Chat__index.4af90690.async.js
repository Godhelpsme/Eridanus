"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[570],{67179:function(je,O,n){n.r(O),n.d(O,{default:function(){return le}});var V=n(19632),T=n.n(V),Y=n(64599),z=n.n(Y),X=n(15009),f=n.n(X),K=n(99289),R=n.n(K),Q=n(5574),S=n.n(Q),v=n(67294),q=n(9361),h=n(2453),_=n(74330),ee=n(4393),ae=n(83622),F=n(16596),re=n(76654),ne=n(45311),te=n(73869),y={container:"container___PlbYR",chatCard:"chatCard___Xx0Vw",chatContainer:"chatContainer___SP6io",message:"message___XLm3g",userMessage:"userMessage___Wp0tl",serverMessage:"serverMessage___GAfYU",bottomTools:"bottomTools___GZxgP",uploadButton:"uploadButton___h6D76",sendButton:"sendButton___gOHpp"},i=n(85893),se=".",oe=function(){var ue=(0,v.useState)([]),N=S()(ue,2),U=N[0],B=N[1],ie=(0,v.useState)(null),k=S()(ie,2),p=k[0],ce=k[1],de=v.useState(!1),A=S()(de,2),fe=A[0],Z=A[1],C=(0,v.useRef)(null),E=v.useRef(null),ve=q.Z.useToken(),D=ve.token,pe=D.colorBgContainer,We=D.borderRadiusLG,he=(0,v.useState)(""),G=S()(he,2),me=G[0],L=G[1];(0,v.useEffect)(function(){return Z(!0),c("Hi"),ge(),function(){p&&p.close()}},[]),(0,v.useEffect)(function(){Te()},[U]);var ge=function t(){var e=new WebSocket("ws://".concat(window.location.hostname,":5008"));e.onopen=function(){Z(!1),h.ZP.success("WebSocket \u5DF2\u8FDE\u63A5\uFF01")},e.onmessage=function(a){Ce(a.data)},e.onclose=function(){window.location.pathname=="/chat"&&(Z(!0),h.ZP.error("WebSocket \u8FDE\u63A5\u5DF2\u65AD\u5F00\uFF0C\u6B63\u5728\u5C1D\u8BD5\u91CD\u65B0\u8FDE\u63A5..."),setTimeout(t,5e3))},e.onerror=function(a){c("WebSocket \u8FDE\u63A5\u9519\u8BEF")},ce(e)},Se=function(e,a){return(0,i.jsxs)("div",{children:[e?"".concat(e):"",a?(0,i.jsx)("img",{src:a,style:{maxWidth:"200px"}}):""]})},ye=function(){var t=R()(f()().mark(function e(a){var u,l;return f()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,fetch("".concat(se,"/api/file2base64"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:a})});case 3:return u=r.sent,r.next=6,u.json();case 6:if(l=r.sent,!l.base64){r.next=11;break}return r.abrupt("return",l.base64);case 11:return console.error("Error:",l.error),r.abrupt("return",null);case 13:r.next=19;break;case 15:return r.prev=15,r.t0=r.catch(0),console.error("Request failed:",r.t0),r.abrupt("return",null);case 19:case"end":return r.stop()}},e,null,[[0,15]])}));return function(a){return t.apply(this,arguments)}}(),$e=function(){var t=R()(f()().mark(function e(a){var u,l,o,r;return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(u=a.target.files,!(!u||u.length===0)){s.next=3;break}return s.abrupt("return");case 3:l=z()(u),s.prev=4,r=f()().mark(function m(){var d,g;return f()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:d=o.value,g=new FileReader,g.onload=function(){var Be=R()(f()().mark(function H(Ze){var $,w,J,x,I;return f()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:w=($=Ze.target)===null||$===void 0?void 0:$.result,J=d.type,x=d.type.split("/")[0],p&&p.readyState===WebSocket.OPEN?(I={type:x,data:{file:w,mime:J}},p.send(JSON.stringify([I])),j("[".concat(d.name,"]"))):h.ZP.error("WebSocket \u8FDE\u63A5\u672A\u5C31\u7EEA");case 4:case"end":return P.stop()}},H)}));return function(H){return Be.apply(this,arguments)}}(),g.readAsDataURL(d);case 4:case"end":return W.stop()}},m)}),l.s();case 7:if((o=l.n()).done){s.next=11;break}return s.delegateYield(r(),"t0",9);case 9:s.next=7;break;case 11:s.next=16;break;case 13:s.prev=13,s.t1=s.catch(4),l.e(s.t1);case 16:return s.prev=16,l.f(),s.finish(16);case 19:case"end":return s.stop()}},e,null,[[4,13,16,19]])}));return function(a){return t.apply(this,arguments)}}(),Ce=function(e){try{var a,u=JSON.parse(e);if(!((a=u.message)!==null&&a!==void 0&&a.params)){console.warn("\u6536\u5230\u65E0\u6548\u6D88\u606F:",u);return}var l=u.message.params.messages||u.message.params.message;if(!Array.isArray(l)){console.warn("\u6D88\u606F\u683C\u5F0F\u9519\u8BEF:",l);return}l.forEach(function(o){var r,b,s,m,d;if(o.type==="text"&&(r=o.data)!==null&&r!==void 0&&r.text)c(o.data.text);else if(o.type==="image"&&(b=o.data)!==null&&b!==void 0&&b.file){var g=o.data.file;ye(g).then(function(M){M?be(M):c("\u6587\u4EF6\u8F6C\u6362\u5931\u8D25")})}else o.type==="video"&&(s=o.data)!==null&&s!==void 0&&s.file?c("[\u89C6\u9891]"):o.type==="audio"&&(m=o.data)!==null&&m!==void 0&&m.file?c("[\u97F3\u9891]"):o.type==="file"&&(d=o.data)!==null&&d!==void 0&&d.file?c("[\u6587\u4EF6]"):c("\u672A\u77E5\u6D88\u606F\u7C7B\u578B: ".concat(o.type))})}catch(o){c("\u89E3\u6790\u670D\u52A1\u5668\u6D88\u606F\u5931\u8D25: "+o),c("[\u6D88\u606F\u683C\u5F0F\u65E0\u6548]")}},j=function(e){B(function(a){return[].concat(T()(a),[{role:"end",content:e}])})},c=function(e){B(function(a){return[].concat(T()(a),[{role:"start",content:e}])})},be=function(e){B(function(a){return[].concat(T()(a),[{role:"start",base64:e}])})},Te=function(){C.current&&(C.current.scrollTop=C.current.scrollHeight)},Re=function(e){e.trim()&&(p&&p.readyState===WebSocket.OPEN?(j(e),p.send(JSON.stringify([{type:"text",data:{text:e}}])),L(""),setTimeout(function(){},10)):h.ZP.error("WebSocket \u672A\u8FDE\u63A5"))};return(0,i.jsx)(_.Z,{spinning:fe,size:"large",children:(0,i.jsxs)(ee.Z,{style:{margin:-20},className:y.chatCard,ref:E,children:[(0,i.jsx)("div",{className:y.chatContainer,ref:C,children:U.map(function(t,e){return(0,i.jsx)(re.Z,{placement:t.role,shape:"corner",className:y.message,messageRender:function(){return Se(t.content,t.base64)}})})}),(0,i.jsx)(ne.Z,{style:{backgroundColor:pe,marginRight:5},placeholder:"\u8BF7\u8F93\u5165...",className:y.bottomTools,value:me,autoSize:!0,onChange:function(e){L(e)},onSubmit:function(e){Re(e)},prefix:(0,i.jsx)(te.Z,{beforeUpload:function(){return!1},onChange:function(e){var a=e.file;j("[".concat(a.name,"]")),h.ZP.info("Mock upload: ".concat(a.name))},getDropContainer:function(){return E.current},placeholder:{icon:(0,i.jsx)(F.Z,{}),title:"\u677E\u5F00\u4E0A\u4F20",description:"\u76EE\u524D\u652F\u6301\u6587\u4EF6\uFF1A\u56FE\u7247"},children:(0,i.jsx)(ae.ZP,{type:"text",icon:(0,i.jsx)(F.Z,{})})})})]})})},le=oe}}]);
